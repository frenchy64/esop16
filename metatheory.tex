\section{Metatheory}
\label{sec:metatheory}

We prove type soundness following \cite{TF10}.  Our model is extended
to include errors and a \wrong{} value, and we prove well-typed
programs do not go wrong; this is therefore a stronger theorem than
proved by \cite{TF10}.

Rather than modeling Java's dynamic semantics, a task of daunting
complexity, we instead make our assumptions about Java explicit. We
concede that method and constructor calls may diverge or error, but
assume they can never go wrong. (Assumptions for other operations are
given in the supplemental material).

{\javanewassumption{main}}



%For readability we define logical truth in Clojure.

%{\istruefalsedefinitions{main}}

For the purposes of our soundness proof, we require that all values
are \emph{consistent}.  Consistency (defined in the supplemental
material) states that the types of closures are well-scoped---they do
not claim propositions about variables hidden in their closures.

%{\consistentwithonlydef{main}}

Our main lemma says if there is a defined reduction, then the propositions, object
and type are correct.
The metavariable \definedreduction{} ranges over \v{}, \errorvalv{} and \wrong{}.

\begin{lemma}\label{main:lemma:soundness}

  {\soundnesslemmahypothesis}
  \begin{proof}
    By induction on the derivation of \opsem {\openv{}} {\e{}} {\a{}}.
    (Full proof given as lemma~\ref{appendix:lemma:soundness}).
  \end{proof}
\end{lemma}


We can now state our soundness theorems.

{\soundnesstheoremnoproof{main}}

{\wrongtheoremnoproof{main}}
%
%{\nilinvoketheoremnoproof{main}}
